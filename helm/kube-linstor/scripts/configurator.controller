#!/bin/bash
set -e
. $(dirname $0)/functions.sh

load_controller_params
wait_controller

{{- with .Values.configurator.controller }}
{{- with .props }}
configure_controller_props {{ mustToJson . | quote }}
{{- end }}

{{- $selectFilter := dict }}
{{- range .resourceGroups }}
{{- range $k, $v := .selectFilter }}
{{- $_ := set $selectFilter (snakecase $k) $v }}
{{- end }}
configure_resource_group {{ .name | quote }} {{ mustToJson $selectFilter | quote }} {{ mustToJson .props | quote }}
{{- $rg_name := .name }}
{{- range .volumeGroups }}
configure_volume_group {{ $rg_name | quote }} {{ .volumeNumber | quote }} {{ mustToJson .props | quote }}
{{- end }}
{{- end }}
{{- end }}

finish
